# Epic 8 Retrospective — Analysis Comparison & Thesis Evolution

**Date:** 2026-02-17
**Facilitator:** Bob (Scrum Master)
**Participants:** Guy (Project Lead), Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)

---

## Epic 8 Summary

- **Stories:** 6/6 completed (100%)
- **Scope:** Full-stack — backend API (comparison sets, thesis evolution history), frontend UI (comparison view, ranked grid, history timeline sidebar, currency handling), E2E test suite
- **Character:** Feature-rich epic delivering two major analyst tools: multi-stock comparison and thesis evolution tracking
- **Code Reviews:** 1–3 rounds per story; 6 HIGH, 12+ MEDIUM issues caught and fixed
- **E2E Tests:** 22 new tests added (total: 45), all passing in CI
- **Production Incidents:** 0

### Stories Delivered

| Story | Title | Status |
|-------|-------|--------|
| 8.1 | Comparison Schema & API | Done |
| 8.2 | Comparison View & Ranked Grid | Done |
| 8.3 | Comparison Currency Handling | Done |
| 8.4 | Thesis Evolution API | Done |
| 8.5 | History Timeline Sidebar & Side-by-Side Comparison | Done |
| 8.6 | Responsive Design & E2E Tests for Comparison and History | Done |

---

## Epic 7 Retro Follow-Through

| # | Action Item | Status |
|---|-------------|--------|
| 1 | E2E test for lock-thesis-to-library flow | ⏳ Not directly covered (Epic 8 E2E focused on comparison/history) |
| 2 | Data persistence E2E tests alongside UI tests | ✅ Story 8.6 seeds data via API and verifies round-trips |
| 3 | Verify features in real environment, not just CI | ✅ Guy verified Docker images after every story |
| 4 | CRITICAL: Fix snapshot creation (seed default user) | ✅ Fixed — all Epic 8 stories create snapshots successfully |
| 5 | Loco Response::builder() boilerplate | ❌ Not addressed (low priority) |
| 6 | Product Vision Document | ❌ Not addressed (carried from Epic 6) |
| 7 | CI debugging findings in MEMORY.md | ✅ Applied |

**Result:** 4/7 completed, 1 in progress, 2 not addressed. Improved from Epic 7's follow-through on the critical items.

---

## Successes

- **100% story delivery with zero production incidents** — clean epic from start to finish
- **Code review process caught every major bug** — 6 HIGH severity issues across 6 stories, each one a real potential production bug (Cardinal Rule violations, broken save flows, unsafe DB config, display currency bugs)
- **`snapshot_metrics.rs` extraction (Story 8.4)** — eliminated triple metric extraction duplication across snapshots, comparisons, and history controllers. Architectural breakthrough.
- **E2E test suite nearly doubled** — from 23 to 45 tests. Story 8.6 established clean patterns: reqwest API seeding, viewport helpers, deterministic waits
- **Real-environment Docker verification** — Guy built and tested Docker images after every story, catching issues that CI alone would miss. Directly addresses Epic 7's "built but inaccessible" concern.
- **Cardinal Rule architecture held** — violations were caught and corrected every time, keeping all calculation logic in `steady-invest-logic`
- **Progressive story dependency chain worked well** — 8.1 schema → 8.2 UI → 8.3 currency → 8.4 history API → 8.5 history UI → 8.6 E2E tests. Each story built cleanly on the previous.

---

## Challenges

- **CI-only test execution (biggest friction point)** — no local `steadyinvest_test` database on NAS meant every test fix required commit → push → wait → read logs → fix → push again. Multiple push cycles per story. Story 8.4 had a dangerous moment where `test.yaml` was pointed at the main DB because the test DB didn't exist.
- **Knowledge transfer between context windows** — lessons from one story didn't automatically flow to the next. Cardinal Rule violations recurred (8.2 and 8.3). `use_navigate()` pattern deferred in 8.2 became HIGH in 8.5. CSS class names in 8.6 spec didn't match actual code.
- **Spec-to-code drift** — Story 8.6 discovered 4 CSS class names and an API endpoint that didn't match the actual implementation. Would have caused 14/22 tests to fail if not caught.
- **Silent deserialization failures** — `LockedAnalysisModel` field name mismatch (`analyst_note`/`created_at` vs backend's `notes`/`captured_at`) caused history toggle to be permanently disabled. Only caught when CI E2E tests ran.
- **WebDriver click interception in headless Chrome** — 0-width CSS Grid sidebar overlapped toggle button in WebDriver's hit-test. Required JS click workaround.

---

## Key Insights

1. **Code review is the project's strongest quality gate** — every story benefited, every HIGH issue was a real bug that would have reached users
2. **Real-environment verification catches what CI misses** — Guy's Docker walkthrough practice should be formalized as part of DoD
3. **Fresh context windows require explicit knowledge transfer** — MEMORY.md and story dev notes are the institutional memory; deferred issues must be documented there
4. **Local test execution eliminates the biggest friction** — the push-wait-read-fix cycle was the single most cited pain point
5. **SSG chart must be audited against NAIC Handbook** — two chart issues discovered (axis ordering, projection extension) plus the official handbook is now available as a reference

---

## Significant Discovery: SSG Methodology Alignment

Two SSG chart issues identified during Guy's Docker walkthroughs:

1. **X-axis year ordering reversed** — historical years display right-to-left (2025→2016) instead of chronological left-to-right
2. **Projection lines not extending correctly** — should project from most recent historical year into the next 5 years per NAIC SSG methodology

**Key resource now available:** `docs/NAIC/SSGHandbook.pdf` — the official NAIC Stock Selection Guide handbook

**Impact:** Epic 9 builds portfolio management and position sizing on top of the SSG analysis. If the chart doesn't faithfully represent the NAIC methodology, portfolio decisions derived from it are unreliable.

**Resolution:** Epic 8b inserted — SSG Handbook audit and corrective sprint before Epic 9.

---

## Action Items

### Process Improvements

1. **Configure local test database connection**
   - Owner: Charlie (Senior Dev)
   - Success criteria: `cargo test` runs locally against `steadyinvest_test` on NAS; credentials via `.env` file (gitignored)
   - Note: Database already created by Guy during retrospective

2. **Capture Docker walkthrough observations as bug list**
   - Owner: Guy (Project Lead)
   - Success criteria: List of UI/UX issues noticed during Epic 8 walkthroughs documented

3. **Carry forward: Product Vision Document**
   - Owner: Alice (Product Owner)
   - Priority: Low (carried from Epic 6 → 7 → 8)

### Technical Debt

1. **SSG chart x-axis year ordering reversed**
   - Priority: High — addressed in Epic 8b

2. **SSG projection lines not extending per NAIC methodology**
   - Priority: High — addressed in Epic 8b

3. **Cardinal Rule enforcement** — no compile-time guard; relies on code review
   - Owner: Team agreement
   - Priority: Medium — document patterns in MEMORY.md

4. **Minor debt carried forward** — no pagination on history/comparison endpoints, no duplicate snapshot validation in comparison items, `on_import` handler unreachable
   - Priority: Low — acceptable for Phase 1 scale

### Team Agreements

- Every story gets real-environment Docker verification (formalized from Guy's practice)
- Deferred code review issues documented in MEMORY.md for next context window
- E2E tests check data correctness where possible, not just element presence

---

## Epic 8b: SSG Methodology Alignment (NEW — before Epic 9)

### Critical Tasks

- [ ] Read `docs/NAIC/SSGHandbook.pdf` thoroughly
- [ ] Audit SSG chart implementation against handbook methodology (axis ordering, projection logic, trend calculation, CAGR computation)
- [ ] Fix identified deviations — chart bugs + any calculation issues
- [ ] Add golden test cases from handbook worked examples to `steady-invest-logic`
- [ ] Verify fixes via Docker walkthrough

---

## Readiness Assessment

| Area | Status |
|------|--------|
| Testing & Quality | ✅ 45 E2E tests + backend suite all passing |
| Deployment | ✅ Docker images built and verified after every story |
| Stakeholder Acceptance | ✅ Guy verified via manual walkthroughs |
| Technical Health | ⚠️ SSG chart issues require Epic 8b before Epic 9 |
| Unresolved Blockers | ⚠️ SSG methodology alignment (Epic 8b) |

**Verdict:** Epic 8 complete from a story perspective. Epic 8b (SSG Handbook audit + fixes) required before Epic 9 can begin. Local test DB created and ready for configuration.

---

## Next Steps

1. Configure local test DB connection (`.env` + `test.yaml`)
2. Execute Epic 8b: SSG Handbook audit and fixes
3. Mark Epic 8 as `done` in sprint status
4. Begin Epic 9 when Epic 8b is complete
